<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HELLOBOB ë£°ë › - í• ì¸</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }
  #popup {
    width: 100%;
    max-width: 500px;
    background: white;
    border-radius: 30px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    padding: 40px 30px;
    text-align: center;
    border: 8px solid #1a1a1a;
  }
  .header {
    margin-bottom: 30px;
  }
  .header .logo {
    font-size: 28px;
    font-weight: 900;
    color: #1a1a1a;
    letter-spacing: 2px;
    margin-bottom: 8px;
  }
  .header .logo-smile {
    display: inline-block;
    font-size: 36px;
    margin: 0 8px;
  }
  .header p {
    color: #555;
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 1px;
    margin-top: 12px;
  }
  .header .subtitle {
    color: #FFD700;
    font-weight: 700;
    font-size: 13px;
    margin-top: 8px;
  }
  .roulette-container {
    position: relative;
    width: 100%;
    max-width: 340px;
    aspect-ratio: 1;
    margin: 30px auto;
    padding: 15px;
    background: #FFD700;
    border-radius: 50%;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2), inset 0 0 0 3px #1a1a1a;
  }
  #roulette {
    width: 100%;
    height: 100%;
    position: relative;
  }
  #wheelCanvas {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
    display: block;
    background: white;
  }
  #pointer {
    width: 0;
    height: 0;
    border-left: 18px solid transparent;
    border-right: 18px solid transparent;
    border-top: 35px solid #1a1a1a;
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
  }
  .center-circle {
    width: 70px;
    height: 70px;
    background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 6px solid #1a1a1a;
    z-index: 5;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2), inset 0 0 10px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
  }
  .controls {
    margin-top: 30px;
  }
  #spinBtn {
    background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
    color: #FFD700;
    border: 4px solid #FFD700;
    padding: 16px 45px;
    font-size: 18px;
    font-weight: 900;
    cursor: pointer;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    letter-spacing: 1px;
    text-transform: uppercase;
    width: 100%;
    max-width: 350px;
  }
  #spinBtn:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
  }
  #spinBtn:disabled {
    background: #999;
    color: #ccc;
    cursor: not-allowed;
    border-color: #ccc;
    box-shadow: none;
  }
  .result-area {
    margin-top: 30px;
    min-height: 100px;
  }
  #result {
    font-size: 26px;
    font-weight: 900;
    color: #1a1a1a;
    margin-bottom: 12px;
    letter-spacing: 1px;
  }
  .result-badge {
    display: inline-block;
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: #1a1a1a;
    padding: 12px 24px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 900;
    margin-bottom: 12px;
    border: 3px solid #1a1a1a;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
  }
  #naverModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 100;
  }
  #naverModal.active {
    display: flex;
  }
  #naverContent {
    background: white;
    padding: 30px 25px;
    border-radius: 20px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    text-align: center;
    border: 6px solid #FFD700;
  }
  #naverContent h2 {
    margin-bottom: 20px;
    font-size: 22px;
    font-weight: 900;
    color: #1a1a1a;
  }
  #naverInput {
    width: 100%;
    padding: 12px;
    border: 2px solid #1a1a1a;
    border-radius: 12px;
    font-size: 16px;
    margin-bottom: 20px;
  }
  #naverInput:focus {
    outline: none;
    border-color: #FFD700;
    box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
  }
  #submitBtn {
    background: linear-gradient(135deg, #00c73c, #1ec800);
    color: white;
    font-weight: 900;
    font-size: 18px;
    padding: 12px 0;
    width: 100%;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  #submitBtn:hover {
    background: #1ec800;
    transform: translateY(-2px);
  }
  .footer {
    margin-top: 25px;
    font-size: 12px;
    color: #666;
    font-weight: 600;
  }
</style>
</head>
<body>

<div id="popup">
  <div class="header">
    <div class="logo">HELLOBOB<span class="logo-smile">ğŸ˜Š</span></div>
    <p>ì„¸ìƒì—ì„œ ê°€ì¥ ë”°ëœ»í•œ ì¸ì‚¬, í—¬ë¡œìš°ë°¥</p>
    <div class="subtitle">ğŸ‰ ëŸ­í‚¤ ë£°ë › ì´ë²¤íŠ¸ ğŸ‰</div>
  </div>

  <div class="roulette-container">
    <div id="roulette">
      <canvas id="wheelCanvas" width="340" height="340"></canvas>
      <div class="center-circle">ğŸ</div>
    </div>
    <div id="pointer"></div>
  </div>

  <div class="controls">
    <button id="spinBtn">ğŸ² ë£°ë › ëŒë¦¬ê¸°!</button>
  </div>

  <div class="result-area">
    <div id="result"></div>
  </div>

  <div class="footer">
    <p>â° 1íšŒ ì œí•œì…ë‹ˆë‹¤</p>
  </div>
</div>

<!-- ë„¤ì´ë²„ ì•„ì´ë”” ì…ë ¥ íŒì—… -->
<div id="naverModal">
  <div id="naverContent">
    <h2>ë„¤ì´ë²„ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” ğŸ†”</h2>
    <input type="text" id="naverInput" placeholder="ì•„ì´ë””_ì…ë ¥ (naver.com ì œì™¸)" maxlength="40" />
    <button id="submitBtn">ì¿ í° ë°›ê¸°</button>
  </div>
</div>

<script>
 const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbz3NTWqXf0OvZ6URlQaSkO0r30B7erMe2Hql-FUcImWZmxQXMIhuvuwxFgl3DHh_fBK/exec';
 
  const canvas = document.getElementById('wheelCanvas');
  const ctx = canvas.getContext('2d');
  const spinBtn = document.getElementById('spinBtn');
  const result = document.getElementById('result');
  const naverModal = document.getElementById('naverModal');
  const naverInput = document.getElementById('naverInput');
  const submitBtn = document.getElementById('submitBtn');

  const segments = [
    { text: '3% í• ì¸', value: 3 },
    { text: '4% í• ì¸', value: 4 },
    { text: '5% í• ì¸', value: 5 },
    { text: '7% í• ì¸', value: 7 },
    { text: '10% í• ì¸', value: 10 },
    { text: '15% í• ì¸', value: 15 },
    { text: '20% í• ì¸', value: 20 },
    { text: 'ë‹¤ìŒ ê¸°íšŒì—', value: 0 }
  ];

  const colors = [
    '#FF6B35', '#F7931E', '#FDB913', '#FFD700',
    '#C1272D', '#004E89', '#1A659E', '#2E8B57'
  ];

  const numSegments = segments.length;
  const segmentAngle = 360 / numSegments;
  
  let isSpinning = false;
  let currentRotation = 0;
  let currentResult = null;
  const SPIN_KEY = 'hellobob_discount_spun';

  const toRad = (deg) => (deg * Math.PI) / 180;

  const drawWheel = (rotationDeg = 0) => {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = canvas.width / 2 - 5;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(toRad(rotationDeg));

    for (let i = 0; i < numSegments; i++) {
      const startAngle = toRad(i * segmentAngle);
      const endAngle = toRad((i + 1) * segmentAngle);

      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.arc(0, 0, radius, startAngle, endAngle);
      ctx.closePath();
      ctx.fillStyle = colors[i];
      ctx.fill();
      ctx.strokeStyle = '#1a1a1a';
      ctx.lineWidth = 4;
      ctx.stroke();

      ctx.save();
      const textAngle = toRad(i * segmentAngle + segmentAngle / 2);
      ctx.rotate(textAngle);
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = 'white';
      ctx.font = 'bold 16px Arial, sans-serif';
      ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
      ctx.shadowBlur = 5;
      ctx.shadowOffsetX = 1;
      ctx.shadowOffsetY = 1;
      ctx.fillText(segments[i].text, radius * 0.68, 0);
      ctx.restore();
    }

    ctx.restore();
  };

  drawWheel(currentRotation);

  const checkSpinStatus = () => {
    return localStorage.getItem(SPIN_KEY) === 'true';
  };

  const updateButton = () => {
    if (checkSpinStatus()) {
      spinBtn.disabled = true;
      spinBtn.textContent = 'âœ… ì´ë¯¸ ì°¸ì—¬í•˜ì…¨ìŠµë‹ˆë‹¤!';
    } else {
      spinBtn.disabled = false;
      spinBtn.textContent = 'ğŸ² ë£°ë › ëŒë¦¬ê¸°!';
    }
  };

  updateButton();

  const getSegmentAtPointer = (rotDeg) => {
    let rot = ((rotDeg % 360) + 360) % 360;
    const pointerPos = 270;
    const adjustedPos = (pointerPos - rot + 360) % 360;
    let segmentIdx = Math.floor(adjustedPos / segmentAngle);
    if (segmentIdx >= numSegments) segmentIdx = numSegments - 1;
    return segmentIdx;
  };

  function showNaverModal() {
    naverInput.value = '';
    naverModal.classList.add('active');
    naverInput.focus();
  }

  function closeNaverModal() {
    naverModal.classList.remove('active');
  }

  spinBtn.addEventListener('click', () => {
    if (isSpinning || checkSpinStatus()) return;

    isSpinning = true;
    spinBtn.disabled = true;
    result.innerHTML = '';

    const targetSegmentIdx = Math.floor(Math.random() * numSegments);
    
    const spins = 5 + Math.random() * 3;
    const spinAmount = spins * 360;
    const targetRotOffset = targetSegmentIdx * segmentAngle + segmentAngle / 2;
    const finalRotation = currentRotation + spinAmount + (270 - targetRotOffset);

    const startTime = Date.now();
    const duration = 5000;

    const animate = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      const easeOut = (t) => 1 - Math.pow(1 - t, 3);
      const easedProgress = easeOut(progress);
      
      const currentDeg = currentRotation + (finalRotation - currentRotation) * easedProgress;
      drawWheel(currentDeg);

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        currentRotation = finalRotation;
        drawWheel(currentRotation);
        
        const resultSegmentIdx = getSegmentAtPointer(currentRotation);
        const selected = segments[resultSegmentIdx];
        currentResult = selected;
        
        localStorage.setItem(SPIN_KEY, 'true');
        
        if (selected.value === 0) {
          result.innerHTML = '<div class="result-badge">ğŸ€ ë‹¤ìŒ ê¸°íšŒì—!</div><div style="font-size: 14px; color: #1a1a1a; margin-top: 8px; font-weight: 600;">ë‹¤ìŒ í–‰ì‚¬ë¥¼ ê¸°ëŒ€í•´ì£¼ì„¸ìš”!</div>';
        } else {
          result.innerHTML = `
            <div class="result-badge">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</div>
            <div style="font-size: 24px; color: #1a1a1a; margin-top: 10px; font-weight: 900;">
              ${selected.text}
            </div>
          `;
          showNaverModal();
        }
        
        updateButton();
        isSpinning = false;
      }
    };

    animate();
  });

  submitBtn.addEventListener('click', () => {
    const naverId = naverInput.value.trim();
    
    if (!naverId) {
      alert('ë„¤ì´ë²„ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }
    
    if (naverId.length < 3 || /\s/.test(naverId)) {
      alert('ì˜¬ë°”ë¥¸ ë„¤ì´ë²„ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ê³µë°± ì—†ìŒ, 3ê¸€ì ì´ìƒ)');
      return;
    }

    submitBtn.disabled = true;

    fetch(GOOGLE_SHEET_URL, {
      method: 'POST',
      body: JSON.stringify({
        naverId: naverId,
        rouletteType: 'í• ì¸',
        discount: currentResult.text
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('âœ… ì‹ ì²­ ì™„ë£Œ! ì¿ í°ì´ ë°œì†¡ë©ë‹ˆë‹¤.');
        closeNaverModal();
        window.location.href = 'https://smartstore.naver.com/babionda';
      } else {
        alert(data.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
      }
      submitBtn.disabled = false;
    })
    .catch(error => {
      alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
      submitBtn.disabled = false;
    });
  });

  naverInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      submitBtn.click();
    }
  });

  // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
  naverModal.addEventListener('click', (e) => {
    if (e.target === naverModal) {
      closeNaverModal();
    }
  });
</script>

</body>
</html>